"use strict";function psp_update_sub_task_progress(t,e,s,a,i,p,r,n){var d=jQuery("#psp-ajax-url").val();jQuery.ajax({url:d+"?action=psp_update_sub_task_fe",type:"post",data:{project_id:t,phase_id:e,task_id:s,parent_id:a,progress:p},success:function(s){i.find(".psp-progress-bar .status").removeClass().addClass("status").addClass("psp-"+s.data.parent_progress),i.attr("data-progress",s.data.parent_progress),psp_update_my_task_count(t,e),"undefined"!=typeof r&&"Yes"==r&&psp_update_phase_completion(t,e),"undefined"!=typeof n&&"Yes"==n&&psp_update_total_progress(t)},error:function(t){console.log(t)}})}jQuery(document).ready(function(t){t("#psp-phases, #psp-archive-content").on("click",".complete-sub-task-link",function(e){e.preventDefault();var s=(t(this).attr("data-target"),t(this).attr("data-project")),a=t(this).attr("data-task"),i=100,p=t(this).attr("data-phase-auto"),r=t(this).attr("data-overall-auto");if(t(this).parents(".task-item").length)var n=t(this).parents(".task-item").find(".psp-task-title").data("phase_id"),d=t(this).parents(".task-item").find(".psp-task-title").data("task_id");else if(t(this).parents(".sub-task-row").length)var n=t(this).parents(".sub-task-row").prev(".task-row").data("phase_id"),d=t(this).parents(".sub-task-row").prev(".task-row").data("task_id");var l=t(".psp-single-"+s+' .psp-phase[data-phase_id="'+n+'"] .psp-task-id-'+d+", .psp-task-project-"+s+" .psp-task-id-"+d+", .project-"+s+'[data-task_id="'+d+'"]');psp_update_sub_task_progress(s,n,a,d,l,i,p,r);var o=t(this).parents(".sub-task-item"),u=t(o).find(".status");"100"==i?t(o).addClass("complete"):t(o).removeClass("complete"),t(u).removeClass().addClass("status").addClass("psp-"+i),t(o).attr("data-progress",i)}),t("#psp-phases, #psp-archive-content").on("click",".sub-task-save-button",function(e){e.preventDefault();var s=t(this).parents(".sub-task-select").find("#edit-sub-task-select-"+t(this).attr("data-phase")+"-"+t(this).attr("data-task")),a=t(this).attr("data-project"),i=t(this).attr("data-task");if(t(this).parents(".task-item").length)var p=t(this).parents(".task-item").find(".psp-task-title").data("phase_id"),r=t(this).parents(".task-item").find(".psp-task-title").data("task_id");else if(t(this).parents(".sub-task-row").length)var p=t(this).parents(".sub-task-row").prev(".task-row").data("phase_id"),r=t(this).parents(".sub-task-row").prev(".task-row").data("task_id");var n=t(s).val(),d=(t(this).parents(".task-select"),t(this).attr("data-phase-auto")),l=t(this).attr("data-overall-auto"),o=t(".psp-single-"+a+' .psp-phase[data-phase_id="'+p+'"] .psp-task-id-'+r+", .psp-task-project-"+a+" .psp-task-id-"+r+", .project-"+a+'[data-task_id="'+r+'"]');psp_update_sub_task_progress(a,p,i,r,o,n,d,l);var u=t(this).parents(".sub-task-item"),f=t(u).find(".status");t(f).removeClass().addClass("status").addClass("psp-"+n),t(u).attr("data-progress",n),"100"==n?t(u).addClass("complete"):t(u).removeClass("complete"),t(this).parents(".psp-sub-task-edit-links").removeClass("is-active")}),t("#psp-phases, #psp-archive-content").on("click",".sub-task-edit-link",function(e){e.preventDefault(),t(this).parents(".psp-sub-task-edit-links").addClass("is-active")})}),function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;t.find('.psp_st-fieldhelpers-field[data-fieldhelpers-name="sub_tasks"] .fieldhelpers-field-repeater-row').remove()}function s(e){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;for(var a in e)s.find('.psp_st-fieldhelpers-field[data-fieldhelpers-name="sub_tasks"] .fieldhelpers-field-repeater-add-button').click();s.find('.psp_st-fieldhelpers-field[data-fieldhelpers-name="sub_tasks"] .fieldhelpers-field-repeater-row').each(function(s,a){var i=e[s];for(var p in i)if("assigned"==p){var r=String(i.assigned);if(r.indexOf(",")>-1)var n=r.split(",");else if(""===r)var n=0;else var n=r;t(a).find('select[data-fieldhelpers-field-select="assigned"]').val(n).trigger("change")}else{var d=i[p];t(a).find('*[name$="'+p+']"]').val(d)}}),t(".subtask-description")&&"undefined"!=typeof tinyMCE&&tinymce.init({selector:"textarea.subtask-description",theme:"modern",skin:"lightgray",menubar:!1,statusbar:!0,plugins:"lists",elements:"pre-details",mode:"exact",toolbar:"bold italic underline justifyleft justifycenter justifyright outdent indent code formatselect numlist bullist"})}t(document).ready(function(){t(document).on("click",".fieldhelpers-field-repeater-add-button",function(e){t('select[data-fieldhelpers-field-select="assigned"]').length&&t('select[data-fieldhelpers-field-select="assigned"]').select2(),t(".subtask-description")&&"undefined"!=typeof tinyMCE&&tinymce.init({selector:"textarea.subtask-description",theme:"modern",skin:"lightgray",menubar:!1,statusbar:!0,plugins:"lists",elements:"pre-details",mode:"exact",toolbar:"bold italic underline justifyleft justifycenter justifyright outdent indent code formatselect numlist bullist"})}),t("#psp-phases").on("click",".fe-edit-task-link",function(a){var i=t(this).attr("href"),p=t(i),r=t(this).data(),n=r.sub_task;e(p),s(n,p),p.find("input[data-fieldhelpers-field-datepicker]").each(function(e,s){var a=t(s).next('input[type="hidden"]').val(),i=a.substring(4,6),p=a.substring(6,8),r=a.substring(0,4),n=new Date(r+"-"+i+"-"+p);""!=t(s).next('input[type="hidden"]').val()?n.setTime(n.getTime()+60*n.getTimezoneOffset()*1e3):n=null,t(s).datepicker("setDate",n).on("changeDate",function(e){console.log("is see change!"),t(this).siblings(".psp-datepicker").val(t(this).val())})})}),t("#psp-phases").on("click",".psp-fe-add-element",function(s){var a=t(this).attr("href"),i=t(a);e(i)})}),t(document).on("psp-fe-deleted-task",function(e,s,a){"function"==typeof rbmFHinitField&&rbmFHinitField(t('.psp_st-fieldhelpers-field[data-fieldhelpers-name="sub_tasks"]').closest(".psp-frontend-field"))})}(jQuery);
//# sourceMappingURL=script.js.map
