{"version":3,"sources":["script.js","subtasks.js","psp-frontend-editor/populate-modal.js"],"names":["psp_update_sub_task_progress","project_id","phase_id","task_id","parent_id","$parentTask","progress","phase_progress","total_progress","ajaxurl","jQuery","val","ajax","url","type","data","success","response","find","removeClass","addClass","parent_progress","attr","psp_update_my_task_count","psp_update_phase_completion","psp_update_total_progress","error","console","log","document","ready","$","on","e","preventDefault","this","parents","length","prev","the_parent","target","task_element","clearRepeater","$modal","arguments","undefined","remove","addRows","subTasks","subTask","click","each","index","row","key","strAssigned","String","assigned","indexOf","split","trigger","value","tinyMCE","tinymce","init","selector","theme","skin","menubar","statusbar","plugins","elements","mode","toolbar","event","select2","values","preview","date","next","month","substring","day","year","dateObject","Date","setTime","getTime","getTimezoneOffset","datepicker","siblings","phase_index","task_index","rbmFHinitField","closest"],"mappings":"AAAA,YCgGA,SAASA,8BAA8BC,EAAYC,EAAUC,EAASC,EAAWC,EAAaC,EAAUC,EAAgBC,GAEpH,GAAIC,GAAYC,OAAO,iBAAiBC,KAE3CD,QAAOE,MACNC,IAAKJ,EAAU,iCACfK,KAAM,OACNC,MACCd,WAAaA,EACbC,SAAYA,EACZC,QAAaA,EACDC,UAAaA,EACzBE,SAAYA,GAEbU,QAAS,SAASC,GAERZ,EAAYa,KAAM,6BAA6BC,cAAcC,SAAS,UAAUA,SAAS,OAASH,EAASF,KAAKM,iBAChHhB,EAAYiB,KAAM,gBAAiBL,EAASF,KAAKM,iBAE1DE,yBAA0BtB,EAAYC,GAER,mBAAnBK,IAAoD,OAAlBA,GAC5CiB,4BAA6BvB,EAAYC,GAGZ,mBAAnBM,IAAoD,OAAlBA,GAC5CiB,0BAA0BxB,IAI5ByB,MAAO,SAASX,GACfY,QAAQC,IAAIb,MA/HfL,OAAOmB,UAAUC,MAAM,SAASC,GAE5BA,EAAE,qCAAqCC,GAAI,QAAS,0BAA2B,SAASC,GAElFA,EAAEC,gBAEF,IACIjC,IADW8B,EAAEI,MAAMb,KAAK,eACVS,EAAEI,MAAMb,KAAK,iBAC3BnB,EAAY4B,EAAEI,MAAMb,KAAK,aACzBhB,EAAa,IACbC,EAAkBwB,EAAEI,MAAMb,KAAK,mBAC/Bd,EAAkBuB,EAAEI,MAAMb,KAAK,oBAEnC,IAAIS,EAAEI,MAAMC,QAAQ,cAAcC,OAC7B,GAAInC,GAAkB6B,EAAEI,MAAMC,QAAQ,cAAclB,KAAK,mBAAmBH,KAAK,YAC7EX,EAAkB2B,EAAEI,MAAMC,QAAQ,cAAclB,KAAK,mBAAmBH,KAAK,eAC/E,IAAKgB,EAAEI,MAAMC,QAAQ,iBAAiBC,OACxC,GAAInC,GAAa6B,EAAEI,MAAMC,QAAQ,iBAAiBE,KAAK,aAAavB,KAAK,YACrEX,EAAc2B,EAAEI,MAAMC,QAAQ,iBAAiBE,KAAK,aAAavB,KAAK,UAI/E,IAAIV,GAAc0B,EAAG,eAAiB9B,EAAa,8BAAgCC,EAAW,mBAAqBE,EAAY,uBAAyBH,EAAa,iBAAmBG,EAAY,cAAgBH,EAAa,kBAAoBG,EAAY,KAGjQJ,8BAA8BC,EAAYC,EAAUC,EAASC,EAAWC,EAAaC,EAAUC,EAAgBC,EAE/G,IAAI+B,GAAaR,EAAEI,MAAMC,QAAQ,kBAClCI,EAAWT,EAAEQ,GAAYrB,KAAK,UAEb,QAAZZ,EACHyB,EAAEQ,GAAYnB,SAAS,YAEvBW,EAAEQ,GAAYpB,YAAY,YAG3BY,EAAES,GAAQrB,cAAcC,SAAS,UAAUA,SAAU,OAASd,GAC9DyB,EAAEQ,GAAYjB,KAAM,gBAAiBhB,KAI3CyB,EAAE,qCAAqCC,GAAI,QAAS,wBAAyB,SAASC,GAElFA,EAAEC,gBAER,IAAIO,GAAgBV,EAAEI,MAAMC,QAAQ,oBAAoBlB,KAAM,yBAA2Ba,EAAEI,MAAMb,KAAK,cAAgB,IAAMS,EAAEI,MAAMb,KAAK,cAC7HrB,EAAc8B,EAAEI,MAAMb,KAAK,gBAC3BnB,EAAY4B,EAAEI,MAAMb,KAAK,YAE7B,IAAIS,EAAEI,MAAMC,QAAQ,cAAcC,OAC7B,GAAInC,GAAkB6B,EAAEI,MAAMC,QAAQ,cAAclB,KAAK,mBAAmBH,KAAK,YAC7EX,EAAkB2B,EAAEI,MAAMC,QAAQ,cAAclB,KAAK,mBAAmBH,KAAK,eAC/E,IAAKgB,EAAEI,MAAMC,QAAQ,iBAAiBC,OACxC,GAAInC,GAAa6B,EAAEI,MAAMC,QAAQ,iBAAiBE,KAAK,aAAavB,KAAK,YACrEX,EAAc2B,EAAEI,MAAMC,QAAQ,iBAAiBE,KAAK,aAAavB,KAAK,UAGvF,IAAIT,GAAayB,EAAEU,GAAc9B,MAG7BJ,GAFcwB,EAAEI,MAAMC,QAAQ,gBAEZL,EAAEI,MAAMb,KAAK,oBAC/Bd,EAAkBuB,EAAEI,MAAMb,KAAK,qBAGvBjB,EAAc0B,EAAG,eAAiB9B,EAAa,8BAAgCC,EAAW,mBAAqBE,EAAY,uBAAyBH,EAAa,iBAAmBG,EAAY,cAAgBH,EAAa,kBAAoBG,EAAY,KAEzQJ,8BAA8BC,EAAYC,EAAUC,EAASC,EAAWC,EAAaC,EAAUC,EAAgBC,EAEvG,IAAI+B,GAAaR,EAAEI,MAAMC,QAAQ,kBAClCI,EAAWT,EAAEQ,GAAYrB,KAAK,UAE7Ba,GAAES,GAAQrB,cAAcC,SAAS,UAAUA,SAAU,OAASd,GAC9DyB,EAAEQ,GAAYjB,KAAK,gBAAgBhB,GAEpB,OAAZA,EACFyB,EAAEQ,GAAYnB,SAAS,YAEvBW,EAAEQ,GAAYpB,YAAY,YAG3BY,EAAEI,MAAMC,QAAQ,4BAA4BjB,YAAY,eAI9DY,EAAE,qCAAqCC,GAAI,QAAS,sBAAuB,SAASC,GAEtFA,EAAEC,iBACMH,EAAEI,MAAMC,QAAQ,4BAA4BhB,SAAS,iBCvF/D,SAAYW,GAiHX,QAASW,KAA+B,GAAhBC,GAAgBC,UAAAP,OAAA,GAAAQ,SAAAD,UAAA,GAAAA,UAAA,GAAP,IAEhCD,GAAOzB,KAAM,mGAAoG4B,SAalH,QAASC,GAASC,GAA0B,GAAhBL,GAAgBC,UAAAP,OAAA,GAAAQ,SAAAD,UAAA,GAAAA,UAAA,GAAP,IAGpC,KAAM,GAAIK,KAAWD,GAEpBL,EAAOzB,KAAM,0GAA2GgC,OAKzHP,GAAOzB,KAAM,mGAAoGiC,KAAM,SAAUC,EAAOC,GAEvI,GAAIJ,GAAUD,EAAUI,EAExB,KAAM,GAAIE,KAAOL,GAEhB,GAAW,YAAPK,EAAoB,CAEvB,GAAIC,GAAcC,OAAOP,EAAQQ,SAEjC,IAAIF,EAAYG,QAAQ,QACvB,GAAID,GAAWF,EAAYI,MAAM,SAC3B,IAAoB,KAAhBJ,EACV,GAAIE,GAAW,MAEf,IAAIA,GAAWF,CAGhBxB,GAAGsB,GAAMnC,KAAM,qDAAsDP,IAAK8C,GAAWG,QAAQ,cAEvF,CAEN,GAAIC,GAAQZ,EAASK,EAErBvB,GAAGsB,GAAMnC,KAAM,YAAcoC,EAAM,OAAQ3C,IAAKkD,MAQ/C9B,EAAE,yBAA+C,mBAAb+B,UACvCC,QAAQC,MACJC,SAAU,+BACVC,MAAQ,SACRC,KAAQ,YACRC,SAAY,EACZC,WAAY,EACZC,QAAY,QACZC,SAAY,cACZC,KAAY,QACdC,QAAS,kHAlLb1C,EAAGF,UAAWC,MAAO,WAEpBC,EAAEF,UAAUG,GAAG,QAAS,0CAA2C,SAAS0C,GAEvE3C,EAAE,qDAAqDM,QACzDN,EAAE,qDAAqD4C,UAGrD5C,EAAE,yBAA+C,mBAAb+B,UACvCC,QAAQC,MACJC,SAAU,+BACVC,MAAQ,SACRC,KAAQ,YACRC,SAAY,EACZC,WAAY,EACZC,QAAY,QACZC,SAAY,cACZC,KAAY,QACdC,QAAS,oHAOb1C,EAAG,eAAgBC,GAAI,QAAS,qBAAsB,SAAU0C,GAE/D,GAAIlC,GAAST,EAAGI,MAAOb,KAAM,QACzBqB,EAASZ,EAAGS,GACZoC,EAAS7C,EAAGI,MAAOpB,OAEnBiC,EAAW4B,EAAA,QAEflC,GAAeC,GAEfI,EAASC,EAAUL,GAEnBA,EAAOzB,KAAM,6CAA8CiC,KAAM,SAAUC,EAAOyB,GAEjF,GAAIC,GAAO/C,EAAG8C,GAAUE,KAAM,wBAAyBpE,MACtDqE,EAAQF,EAAKG,UAAW,EAAG,GAC3BC,EAAMJ,EAAKG,UAAW,EAAG,GACzBE,EAAOL,EAAKG,UAAW,EAAG,GAC1BG,EAAa,GAAIC,MAAMF,EAAO,IAAMH,EAAQ,IAAME,EAGO,KAArDnD,EAAG8C,GAAUE,KAAM,wBAAyBpE,MAE/CyE,EAAWE,QAASF,EAAWG,UAA6C,GAAjCH,EAAWI,oBAA2B,KAEjFJ,EAAa,KAGdrD,EAAG8C,GAAUY,WAAY,UAAWL,GAAapD,GAAG,aAAc,SAASC,GAE1EN,QAAQC,IAAI,kBAEZG,EAAEI,MAAMuD,SAAS,mBAAmB/E,IAAKoB,EAAEI,MAAMxB,aASrDoB,EAAG,eAAgBC,GAAI,QAAS,sBAAuB,SAAU0C,GAEhE,GAAIlC,GAAST,EAAGI,MAAOb,KAAM,QACzBqB,EAASZ,EAAGS,EAEhBE,GAAeC,OAkBjBZ,EAAGF,UAAWG,GAAI,sBAAuB,SAAU0C,EAAOiB,EAAaC,GAEvC,kBAAnBC,iBAGXA,eAAgB9D,EAAG,kEAAmE+D,QAAS,2BA2F7FpF","file":"script.js","sourcesContent":["'use strict';\n\njQuery(document).ready(function ($) {\n\n  $('#psp-phases, #psp-archive-content').on('click', '.complete-sub-task-link', function (e) {\n\n    e.preventDefault();\n\n    var formID = $(this).attr('data-target');\n    var project_id = $(this).attr('data-project');\n    var task_id = $(this).attr('data-task');\n    var progress = 100;\n    var phase_progress = $(this).attr('data-phase-auto');\n    var total_progress = $(this).attr('data-overall-auto');\n\n    if ($(this).parents('.task-item').length) {\n      var phase_id = $(this).parents('.task-item').find('.psp-task-title').data('phase_id'); // This is the wrong one for some reason\n      var parent_id = $(this).parents('.task-item').find('.psp-task-title').data('task_id');\n    } else if ($(this).parents('.sub-task-row').length) {\n      var phase_id = $(this).parents('.sub-task-row').prev('.task-row').data('phase_id');\n      var parent_id = $(this).parents('.sub-task-row').prev('.task-row').data('task_id');\n    }\n\n    // Single, Dashboard, and Your Tasks view\n    var $parentTask = $('.psp-single-' + project_id + ' .psp-phase[data-phase_id=\"' + phase_id + '\"] .psp-task-id-' + parent_id + ', .psp-task-project-' + project_id + ' .psp-task-id-' + parent_id + ', .project-' + project_id + '[data-task_id=\"' + parent_id + '\"]');\n\n    // Update dynamically\n    psp_update_sub_task_progress(project_id, phase_id, task_id, parent_id, $parentTask, progress, phase_progress, total_progress);\n\n    var the_parent = $(this).parents('.sub-task-item'),\n        target = $(the_parent).find('.status');\n\n    if (progress == '100') {\n      $(the_parent).addClass('complete');\n    } else {\n      $(the_parent).removeClass('complete');\n    }\n\n    $(target).removeClass().addClass('status').addClass('psp-' + progress);\n    $(the_parent).attr('data-progress', progress);\n  });\n\n  $('#psp-phases, #psp-archive-content').on('click', '.sub-task-save-button', function (e) {\n\n    e.preventDefault();\n\n    var task_element = $(this).parents('.sub-task-select').find('#edit-sub-task-select-' + $(this).attr('data-phase') + '-' + $(this).attr('data-task'));\n    var project_id = $(this).attr('data-project');\n    var task_id = $(this).attr('data-task');\n\n    if ($(this).parents('.task-item').length) {\n      var phase_id = $(this).parents('.task-item').find('.psp-task-title').data('phase_id');\n      var parent_id = $(this).parents('.task-item').find('.psp-task-title').data('task_id');\n    } else if ($(this).parents('.sub-task-row').length) {\n      var phase_id = $(this).parents('.sub-task-row').prev('.task-row').data('phase_id');\n      var parent_id = $(this).parents('.sub-task-row').prev('.task-row').data('task_id');\n    }\n\n    var progress = $(task_element).val();\n    var parent_div = $(this).parents('.task-select');\n\n    var phase_progress = $(this).attr('data-phase-auto');\n    var total_progress = $(this).attr('data-overall-auto');\n\n    // Single, Dashboard, and Your Tasks view\n    var $parentTask = $('.psp-single-' + project_id + ' .psp-phase[data-phase_id=\"' + phase_id + '\"] .psp-task-id-' + parent_id + ', .psp-task-project-' + project_id + ' .psp-task-id-' + parent_id + ', .project-' + project_id + '[data-task_id=\"' + parent_id + '\"]');\n\n    psp_update_sub_task_progress(project_id, phase_id, task_id, parent_id, $parentTask, progress, phase_progress, total_progress);\n\n    var the_parent = $(this).parents('.sub-task-item'),\n        target = $(the_parent).find('.status');\n\n    $(target).removeClass().addClass('status').addClass('psp-' + progress);\n    $(the_parent).attr('data-progress', progress);\n\n    if (progress == '100') {\n      $(the_parent).addClass('complete');\n    } else {\n      $(the_parent).removeClass('complete');\n    }\n\n    $(this).parents('.psp-sub-task-edit-links').removeClass('is-active');\n  });\n\n  $('#psp-phases, #psp-archive-content').on('click', '.sub-task-edit-link', function (e) {\n\n    e.preventDefault();\n    $(this).parents('.psp-sub-task-edit-links').addClass('is-active');\n\n    // var the_parent = $(this).parents('.sub-task-item');\n    // $(the_parent).children('.sub-task-select').fadeIn('slow');\n  });\n});\n\nfunction psp_update_sub_task_progress(project_id, phase_id, task_id, parent_id, $parentTask, progress, phase_progress, total_progress) {\n\n  var ajaxurl = jQuery('#psp-ajax-url').val();\n\n  jQuery.ajax({\n    url: ajaxurl + \"?action=psp_update_sub_task_fe\",\n    type: 'post',\n    data: {\n      project_id: project_id,\n      phase_id: phase_id,\n      task_id: task_id,\n      parent_id: parent_id,\n      progress: progress\n    },\n    success: function success(response) {\n\n      $parentTask.find('.psp-progress-bar .status').removeClass().addClass('status').addClass('psp-' + response.data.parent_progress);\n      $parentTask.attr('data-progress', response.data.parent_progress);\n\n      psp_update_my_task_count(project_id, phase_id);\n\n      if (typeof phase_progress !== 'undefined' && phase_progress == 'Yes') {\n        psp_update_phase_completion(project_id, phase_id);\n      }\n\n      if (typeof total_progress !== 'undefined' && total_progress == 'Yes') {\n        psp_update_total_progress(project_id);\n      }\n    },\n    error: function error(data) {\n      console.log(data);\n    }\n  });\n}\n'use strict';\n\n(function ($) {\n\n\t$(document).ready(function () {\n\n\t\t$(document).on('click', '.fieldhelpers-field-repeater-add-button', function (event) {\n\n\t\t\tif ($('select[data-fieldhelpers-field-select=\"assigned\"]').length) {\n\t\t\t\t$('select[data-fieldhelpers-field-select=\"assigned\"]').select2();\n\t\t\t}\n\n\t\t\tif ($('.subtask-description') && typeof tinyMCE !== 'undefined') {\n\t\t\t\ttinymce.init({\n\t\t\t\t\tselector: 'textarea.subtask-description',\n\t\t\t\t\ttheme: 'modern',\n\t\t\t\t\tskin: 'lightgray',\n\t\t\t\t\tmenubar: false,\n\t\t\t\t\tstatusbar: true,\n\t\t\t\t\tplugins: 'lists',\n\t\t\t\t\telements: 'pre-details',\n\t\t\t\t\tmode: 'exact',\n\t\t\t\t\ttoolbar: \"bold italic underline justifyleft justifycenter justifyright outdent indent code formatselect numlist bullist\"\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\t$('#psp-phases').on('click', '.fe-edit-task-link', function (event) {\n\n\t\t\tvar target = $(this).attr('href');\n\t\t\tvar $modal = $(target);\n\t\t\tvar values = $(this).data();\n\n\t\t\tvar subTasks = values['sub_task'];\n\n\t\t\tclearRepeater($modal);\n\n\t\t\taddRows(subTasks, $modal);\n\n\t\t\t$modal.find('input[data-fieldhelpers-field-datepicker]').each(function (index, preview) {\n\n\t\t\t\tvar date = $(preview).next('input[type=\"hidden\"]').val(),\n\t\t\t\t    month = date.substring(4, 6),\n\t\t\t\t    day = date.substring(6, 8),\n\t\t\t\t    year = date.substring(0, 4),\n\t\t\t\t    dateObject = new Date(year + '-' + month + '-' + day);\n\n\t\t\t\t// Don't populate a value if there is no due date\n\t\t\t\tif ($(preview).next('input[type=\"hidden\"]').val() != '') {\n\t\t\t\t\t// https://stackoverflow.com/a/16048201\n\t\t\t\t\tdateObject.setTime(dateObject.getTime() + dateObject.getTimezoneOffset() * 60 * 1000);\n\t\t\t\t} else {\n\t\t\t\t\tdateObject = null;\n\t\t\t\t}\n\n\t\t\t\t$(preview).datepicker('setDate', dateObject).on('changeDate', function (e) {\n\n\t\t\t\t\tconsole.log('is see change!');\n\n\t\t\t\t\t$(this).siblings('.psp-datepicker').val($(this).val());\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\n\t\t$('#psp-phases').on('click', '.psp-fe-add-element', function (event) {\n\n\t\t\tvar target = $(this).attr('href');\n\t\t\tvar $modal = $(target);\n\n\t\t\tclearRepeater($modal);\n\t\t});\n\t});\n\n\t/*\n $( document ).on( 'psp-fe-task-edit-modal-populated', function( event, $modal, values ) {\n \t\t// With our Included Datepicker, we don't want to do it based on the field value. No tomfoolery necessary\n \t$modal.find( 'input.psp-datepicker' ).each( function( index, field ) {\n \t\t\t$( field ).datepicker();\n \t\t} );\n \t} ); */\n\n\t$(document).on('psp-fe-deleted-task', function (event, phase_index, task_index) {\n\n\t\tif (typeof rbmFHinitField === 'function') {\n\n\t\t\t// Re-init the Repeater field\n\t\t\trbmFHinitField($('.psp_st-fieldhelpers-field[data-fieldhelpers-name=\"sub_tasks\"]').closest('.psp-frontend-field'));\n\t\t} else {\n\t\t\t// Oh well, Repeaters will be broken on Task Delete if an older RBM FH is running\n\t\t}\n\t});\n\n\t/**\n  * Clears the Sub Task Repeater of all Values\n  *\n  * @param\t\t{object} $modal Task Edit Modal jQuery Object\n  *\n  * @since\t\t{{VERSION}}\n  * @return\t\tvoid\n  */\n\tfunction clearRepeater() {\n\t\tvar $modal = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;\n\n\n\t\t$modal.find('.psp_st-fieldhelpers-field[data-fieldhelpers-name=\"sub_tasks\"] .fieldhelpers-field-repeater-row').remove();\n\t}\n\n\t/**\n  * Clears the Sub Task Repeater of all Values\n  *\n  * @param\t\t{Array} subTasks      Array of Objects representing the values for each Row\n  * @param\t\t{object} $modal       Task Edit Modal jQuery Object\n  *\n  * @since\t\t{{VERSION}}\n  * @return\t\tvoid\n  */\n\tfunction addRows(subTasks) {\n\t\tvar $modal = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n\n\n\t\t// Add Rows\n\t\tfor (var subTask in subTasks) {\n\n\t\t\t$modal.find('.psp_st-fieldhelpers-field[data-fieldhelpers-name=\"sub_tasks\"] .fieldhelpers-field-repeater-add-button').click();\n\t\t}\n\n\t\t// Populate Rows\n\t\t$modal.find('.psp_st-fieldhelpers-field[data-fieldhelpers-name=\"sub_tasks\"] .fieldhelpers-field-repeater-row').each(function (index, row) {\n\n\t\t\tvar subTask = subTasks[index];\n\n\t\t\tfor (var key in subTask) {\n\n\t\t\t\tif (key == 'assigned') {\n\n\t\t\t\t\tvar strAssigned = String(subTask.assigned);\n\n\t\t\t\t\tif (strAssigned.indexOf(',') > -1) {\n\t\t\t\t\t\tvar assigned = strAssigned.split(',');\n\t\t\t\t\t} else if (strAssigned === \"\") {\n\t\t\t\t\t\tvar assigned = 0;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar assigned = strAssigned;\n\t\t\t\t\t}\n\n\t\t\t\t\t$(row).find('select[data-fieldhelpers-field-select=\"assigned\"]').val(assigned).trigger('change');\n\t\t\t\t} else {\n\n\t\t\t\t\tvar value = subTask[key];\n\n\t\t\t\t\t$(row).find('*[name$=\"' + key + ']\"]').val(value);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tif ($('.subtask-description') && typeof tinyMCE !== 'undefined') {\n\t\t\ttinymce.init({\n\t\t\t\tselector: 'textarea.subtask-description',\n\t\t\t\ttheme: 'modern',\n\t\t\t\tskin: 'lightgray',\n\t\t\t\tmenubar: false,\n\t\t\t\tstatusbar: true,\n\t\t\t\tplugins: 'lists',\n\t\t\t\telements: 'pre-details',\n\t\t\t\tmode: 'exact',\n\t\t\t\ttoolbar: \"bold italic underline justifyleft justifycenter justifyright outdent indent code formatselect numlist bullist\"\n\t\t\t});\n\t\t}\n\t}\n})(jQuery);","jQuery(document).ready(function($) {\n\n    $('#psp-phases, #psp-archive-content').on( 'click', '.complete-sub-task-link', function(e) {\n\n         \te.preventDefault();\n\n          var formID \t\t= $(this).attr('data-target');\n          var project_id \t= $(this).attr('data-project');\n          var task_id \t\t= $(this).attr('data-task');\n          var progress \t\t= 100;\n          var phase_progress \t= $(this).attr('data-phase-auto');\n          var total_progress \t= $(this).attr('data-overall-auto');\n\n          if( $(this).parents('.task-item').length ) {\n               var phase_id        = $(this).parents('.task-item').find('.psp-task-title').data('phase_id'); // This is the wrong one for some reason\n               var parent_id       = $(this).parents('.task-item').find('.psp-task-title').data('task_id');\n          } else if ( $(this).parents('.sub-task-row').length ) {\n               var phase_id \t\t= $(this).parents('.sub-task-row').prev('.task-row').data('phase_id');\n               var parent_id \t\t= $(this).parents('.sub-task-row').prev('.task-row').data('task_id');\n          }\n\n          // Single, Dashboard, and Your Tasks view\n          var $parentTask = $( '.psp-single-' + project_id + ' .psp-phase[data-phase_id=\"' + phase_id + '\"] .psp-task-id-' + parent_id + ', .psp-task-project-' + project_id + ' .psp-task-id-' + parent_id + ', .project-' + project_id + '[data-task_id=\"' + parent_id + '\"]'  );\n\n          // Update dynamically\n          psp_update_sub_task_progress( project_id, phase_id, task_id, parent_id, $parentTask, progress, phase_progress, total_progress );\n\n          var the_parent = $(this).parents('.sub-task-item'),\n        \ttarget \t\t= $(the_parent).find('.status');\n\n          if( progress == '100' ) {\n         \t\t$(the_parent).addClass('complete');\n         \t} else {\n         \t\t$(the_parent).removeClass('complete');\n         \t}\n\n          $(target).removeClass().addClass('status').addClass( 'psp-' + progress );\n          $(the_parent).attr( 'data-progress', progress );\n\n    });\n\n    $('#psp-phases, #psp-archive-content').on( 'click', '.sub-task-save-button', function(e) {\n\n        e.preventDefault();\n\n\t\tvar task_element \t= $(this).parents('.sub-task-select').find( '#edit-sub-task-select-' + $(this).attr('data-phase') + '-' + $(this).attr('data-task') );\n          var project_id \t= $(this).attr('data-project');\n          var task_id \t\t= $(this).attr('data-task');\n\n          if( $(this).parents('.task-item').length ) {\n               var phase_id        = $(this).parents('.task-item').find('.psp-task-title').data('phase_id');\n               var parent_id       = $(this).parents('.task-item').find('.psp-task-title').data('task_id');\n          } else if ( $(this).parents('.sub-task-row').length ) {\n               var phase_id \t\t= $(this).parents('.sub-task-row').prev('.task-row').data('phase_id');\n               var parent_id \t\t= $(this).parents('.sub-task-row').prev('.task-row').data('task_id');\n          }\n\n\t\tvar progress \t\t= $(task_element).val();\n\t\tvar parent_div \t= $(this).parents('.task-select');\n\n\t\tvar phase_progress \t= $(this).attr('data-phase-auto');\n\t\tvar total_progress \t= $(this).attr('data-overall-auto');\n\n\t\t// Single, Dashboard, and Your Tasks view\n          var $parentTask = $( '.psp-single-' + project_id + ' .psp-phase[data-phase_id=\"' + phase_id + '\"] .psp-task-id-' + parent_id + ', .psp-task-project-' + project_id + ' .psp-task-id-' + parent_id + ', .project-' + project_id + '[data-task_id=\"' + parent_id + '\"]'  );\n\n\t\tpsp_update_sub_task_progress( project_id, phase_id, task_id, parent_id, $parentTask, progress, phase_progress, total_progress );\n\n          var the_parent = $(this).parents('.sub-task-item'),\n        \ttarget \t\t= $(the_parent).find('.status');\n\n          $(target).removeClass().addClass('status').addClass( 'psp-' + progress );\n          $(the_parent).attr('data-progress',progress);\n\n          if(progress == '100') {\n          \t$(the_parent).addClass('complete');\n          } else {\n          \t$(the_parent).removeClass('complete');\n          }\n\n          $(this).parents('.psp-sub-task-edit-links').removeClass('is-active');\n\n    });\n\n    $('#psp-phases, #psp-archive-content').on( 'click', '.sub-task-edit-link', function(e) {\n\n\t\te.preventDefault();\n          $(this).parents('.psp-sub-task-edit-links').addClass('is-active');\n\n\t\t// var the_parent = $(this).parents('.sub-task-item');\n          // $(the_parent).children('.sub-task-select').fadeIn('slow');\n\n\t});\n\n});\n\nfunction psp_update_sub_task_progress( project_id, phase_id, task_id, parent_id, $parentTask, progress, phase_progress, total_progress ) {\n\n    var ajaxurl \t\t= jQuery('#psp-ajax-url').val();\n\n\tjQuery.ajax({\n\t\turl: ajaxurl + \"?action=psp_update_sub_task_fe\",\n\t\ttype: 'post',\n\t\tdata: {\n\t\t\tproject_id : project_id,\n\t\t\tphase_id\t : phase_id,\n\t\t\ttask_id    : task_id,\n               parent_id  : parent_id,\n\t\t\tprogress\t : progress\n\t\t},\n\t\tsuccess: function(response) {\n\n            $parentTask.find( '.psp-progress-bar .status').removeClass().addClass('status').addClass('psp-' + response.data.parent_progress );\n            $parentTask.attr( 'data-progress', response.data.parent_progress );\n\n\t\t\tpsp_update_my_task_count( project_id, phase_id );\n\n\t\t\tif( typeof phase_progress !== 'undefined' && phase_progress == 'Yes' ) {\n\t\t\t\tpsp_update_phase_completion( project_id, phase_id );\n\t\t\t}\n\n\t\t\tif( typeof total_progress !== 'undefined' && total_progress == 'Yes' ) {\n\t\t\t\tpsp_update_total_progress(project_id);\n\t\t\t}\n\n\t\t},\n\t\terror: function(data) {\n\t\t\tconsole.log(data);\n\t\t}\n\t});\n\n}\n","( function( $ ) {\n\n\t$( document ).ready( function() {\n\n\t\t$(document).on('click', '.fieldhelpers-field-repeater-add-button', function(event) {\n\n\t\t\tif( $('select[data-fieldhelpers-field-select=\"assigned\"]').length ) {\n\t\t\t\t $('select[data-fieldhelpers-field-select=\"assigned\"]').select2();\n\t\t\t}\n\n\t\t\tif( $('.subtask-description') && typeof(tinyMCE) !== 'undefined' ) {\n\t\t\t\ttinymce.init({\n\t\t\t\t    selector: 'textarea.subtask-description',\n\t\t\t\t    theme : 'modern',\n\t\t\t\t    skin  : 'lightgray',\n\t\t\t\t    menubar   : false,\n\t\t\t\t    statusbar : true,\n\t\t\t\t    plugins   : 'lists',\n\t\t\t\t    elements  : 'pre-details',\n\t\t\t\t    mode      : 'exact',\n\t\t\t\t\t toolbar: \"bold italic underline justifyleft justifycenter justifyright outdent indent code formatselect numlist bullist\"\n\t\t\t\t});\n\n\t\t\t}\n\n\t\t});\n\n\t\t$( '#psp-phases' ).on( 'click', '.fe-edit-task-link', function( event ) {\n\n\t\t\tvar target = $( this ).attr( 'href' );\n\t\t\tvar $modal = $( target );\n\t\t\tvar values = $( this ).data();\n\n\t\t\tvar subTasks = values['sub_task'];\n\n\t\t\tclearRepeater( $modal );\n\n\t\t\taddRows( subTasks, $modal );\n\n\t\t\t$modal.find( 'input[data-fieldhelpers-field-datepicker]' ).each( function( index, preview ) {\n\n\t\t\t\tvar date = $( preview ).next( 'input[type=\"hidden\"]' ).val(),\n\t\t\t\t\tmonth = date.substring( 4, 6 ),\n\t\t\t\t\tday = date.substring( 6, 8 ),\n\t\t\t\t\tyear = date.substring( 0, 4 ),\n\t\t\t\t\tdateObject = new Date( year + '-' + month + '-' + day );\n\n\t\t\t\t\t// Don't populate a value if there is no due date\n\t\t\t\t\tif( $( preview ).next( 'input[type=\"hidden\"]' ).val() != '' ) {\n\t\t\t\t\t\t// https://stackoverflow.com/a/16048201\n\t\t\t\t\t\tdateObject.setTime( dateObject.getTime() + dateObject.getTimezoneOffset() * 60 * 1000 );\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdateObject = null;\n\t\t\t\t\t}\n\n\t\t\t\t\t$( preview ).datepicker( 'setDate', dateObject ).on('changeDate', function(e) {\n\n\t\t\t\t\t\tconsole.log('is see change!');\n\n\t\t\t\t\t\t$(this).siblings('.psp-datepicker').val( $(this).val() );\n\n\t\t\t\t\t});\n\n\n\t\t\t} );\n\n\t\t} );\n\n\t\t$( '#psp-phases' ).on( 'click', '.psp-fe-add-element', function( event ) {\n\n\t\t\tvar target = $( this ).attr( 'href' );\n\t\t\tvar $modal = $( target );\n\n\t\t\tclearRepeater( $modal );\n\n\t\t} );\n\n\t} );\n\n\t/*\n\t$( document ).on( 'psp-fe-task-edit-modal-populated', function( event, $modal, values ) {\n\n\t\t// With our Included Datepicker, we don't want to do it based on the field value. No tomfoolery necessary\n\t\t$modal.find( 'input.psp-datepicker' ).each( function( index, field ) {\n\n\t\t\t$( field ).datepicker();\n\n\t\t} );\n\n\t} ); */\n\n\t$( document ).on( 'psp-fe-deleted-task', function( event, phase_index, task_index ) {\n\n\t\tif ( typeof rbmFHinitField === 'function' ) {\n\n\t\t\t// Re-init the Repeater field\n\t\t\trbmFHinitField( $( '.psp_st-fieldhelpers-field[data-fieldhelpers-name=\"sub_tasks\"]' ).closest( '.psp-frontend-field' ) );\n\n\t\t}\n\t\telse {\n\t\t\t// Oh well, Repeaters will be broken on Task Delete if an older RBM FH is running\n\t\t}\n\n\t} );\n\n\t/**\n\t * Clears the Sub Task Repeater of all Values\n\t *\n\t * @param\t\t{object} $modal Task Edit Modal jQuery Object\n\t *\n\t * @since\t\t{{VERSION}}\n\t * @return\t\tvoid\n\t */\n\tfunction clearRepeater( $modal = null ) {\n\n\t\t$modal.find( '.psp_st-fieldhelpers-field[data-fieldhelpers-name=\"sub_tasks\"] .fieldhelpers-field-repeater-row' ).remove();\n\n\t}\n\n\t/**\n\t * Clears the Sub Task Repeater of all Values\n\t *\n\t * @param\t\t{Array} subTasks      Array of Objects representing the values for each Row\n\t * @param\t\t{object} $modal       Task Edit Modal jQuery Object\n\t *\n\t * @since\t\t{{VERSION}}\n\t * @return\t\tvoid\n\t */\n\tfunction addRows( subTasks, $modal = null ) {\n\n\t\t// Add Rows\n\t\tfor ( var subTask in subTasks ) {\n\n\t\t\t$modal.find( '.psp_st-fieldhelpers-field[data-fieldhelpers-name=\"sub_tasks\"] .fieldhelpers-field-repeater-add-button' ).click();\n\n\t\t}\n\n\t\t// Populate Rows\n\t\t$modal.find( '.psp_st-fieldhelpers-field[data-fieldhelpers-name=\"sub_tasks\"] .fieldhelpers-field-repeater-row' ).each( function( index, row ) {\n\n\t\t\tvar subTask = subTasks[ index ];\n\n\t\t\tfor ( var key in subTask ) {\n\n\t\t\t\tif( key == 'assigned' ) {\n\n\t\t\t\t\tvar strAssigned = String(subTask.assigned);\n\n\t\t\t\t\tif( strAssigned.indexOf(',') > -1 ) {\n\t\t\t\t\t\tvar assigned = strAssigned.split(',');\n\t\t\t\t\t} else if( strAssigned === \"\" ) {\n\t\t\t\t\t\tvar assigned = 0;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar assigned = strAssigned;\n\t\t\t\t\t}\n\n\t\t\t\t\t$( row ).find( 'select[data-fieldhelpers-field-select=\"assigned\"]' ).val( assigned ).trigger('change');\n\n\t\t\t\t} else {\n\n\t\t\t\t\tvar value = subTask[ key ];\n\n\t\t\t\t\t$( row ).find( '*[name$=\"' + key + ']\"]' ).val( value );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t} );\n\n\t\tif( $('.subtask-description') && typeof(tinyMCE) !== 'undefined' ) {\n\t\t\ttinymce.init({\n\t\t\t    selector: 'textarea.subtask-description',\n\t\t\t    theme : 'modern',\n\t\t\t    skin  : 'lightgray',\n\t\t\t    menubar   : false,\n\t\t\t    statusbar : true,\n\t\t\t    plugins   : 'lists',\n\t\t\t    elements  : 'pre-details',\n\t\t\t    mode      : 'exact',\n\t\t\t\t toolbar: \"bold italic underline justifyleft justifycenter justifyright outdent indent code formatselect numlist bullist\"\n\t\t\t});\n\n\t\t}\n\n\t}\n\n} )( jQuery );\n"]}